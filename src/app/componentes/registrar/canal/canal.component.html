<div class="col-xs-12">

  <h2>Registro de canal</h2>

  <br>

  <ng4-loading-spinner> </ng4-loading-spinner>

  <div *ngIf="estatus == 1" class="alert alert-success" role="alert">
    Canal registrado exitosamente
  </div>
  <div *ngIf="estatus == 0" class="alert alert-danger" role="alert">
    No se pudo registrar el canal
  </div>
  <div *ngIf="estatus == 2" class="alert alert-warning" role="alert">
    El codigo del canal ya ha sido registrado
  </div>

  <form #form="ngForm" (ngSubmit)="registrar(form)">

    <tabset #staticTabs>

      <tab heading="Ubicación">

        <br/>

        <h2>Secciones por donde pasa el canal</h2>

        <div *ngIf="estatus == 3" class="alert alert-warning" role="alert">
          La seccion ya esta agregada.
        </div>

        <div class="row">
          <div class="col-xs-6">

            <div class="form-group">
              <label class="control-label" for="unidad">Seleccione la unidad</label>
              <select #unidad="ngModel" [(ngModel)]="unidadId" (change)="unidadChange()" name="unidad" class="form-control" id="unidad"
                [compareWith]="compareFn">
                <option [ngValue]='{"id":-1}' [selected]="unidadId.id == -1">-- Seleccione --</option>
                <option *ngFor="let u of lstUnidad" [ngValue]="u">{{u.nombre}}</option>
                <option *ngIf="lstUnidad.length == 0" [ngValue]='{"id":-1}'>No hay unidades</option>
              </select>
            </div>

            <div class="form-group">
              <label class="control-label" for="zona">Seleccione la zona</label>
              <select #zona="ngModel" [(ngModel)]="zonaId" (change)="zonaChange()" name="zona" class="form-control" id="zona" [compareWith]="compareFn">
                <option [ngValue]='{"id":-1}' [selected]="zonaId.id == -1">-- Seleccione --</option>
                <option *ngFor="let z of lstZona" [ngValue]="z">{{z.nombre}}</option>
                <option *ngIf="lstZona.length == 0" [ngValue]='{"id":-1}'>No hay zonas</option>
              </select>
            </div>

            <div class="form-group">
              <label class="control-label" for="seccion">Seleccione la sección</label>
              <select #seccion="ngModel" [(ngModel)]="seccionId" name="seccion" class="form-control" id="seccion" [compareWith]="compareFn">
                <option [ngValue]='{"id":-1}' [selected]="seccionId.id == -1" >-- Seleccione --</option>
                <option *ngFor="let s of lstSeccion" [ngValue]="s">{{s.nombre}}</option>
                <option *ngIf="lstSeccion.length == 0" [ngValue]='{"id":-1}'>No hay secciones</option>
              </select>
            </div>

            <button type="button" class="btn btn-success" (click)="agregarSeccion()">Agregar</button>

          </div>
          <div class="col-xs-6">
            <div class="col-xs-12">

              <ul *ngIf="lstUbicacionCanal.length != 0" class="list-group">
                <li *ngFor="let u of lstUbicacionCanal; let i = index" [attr.data-index]="i" class="list-group-item">
                  {{u}}
                  <span style="cursor: pointer" (click)="eliminarUbicacion(i)" class="badge badge-default badge-pill">eliminar</span>
                </li>
              </ul>
            </div>
          </div>

        </div>

      </tab>

      <tab heading="Datos basicos" [disabled]="lstSeccionCanal.length == 0">

        <br/>

        <div class="row">
          <div class="col-xs-6">

            <div [ngClass]="(!codigo.valid && codigo.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="codigo">Código del canal</label>
              <input #codigo="ngModel" [(ngModel)]="canal.codigo" name="canal" type="text" class="form-control" placeholder="Ingrese código del canal"
                required/>
              <span class="msg-error" *ngIf="!codigo.valid && codigo.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!nombre.valid && nombre.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="nombre">Nombre del canal</label>
              <input #nombre="ngModel" [(ngModel)]="canal.nombre" name="nombre" type="text" class="form-control" placeholder="Ingrese nombre del canal"
                required/>
              <span class="msg-error" *ngIf="!nombre.valid && nombre.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!caudal.valid && caudal.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="caudal">Canudal diseño</label>
              <input #caudal="ngModel" [(ngModel)]="canal.caudalDisenio" name="caudal" type="text" class="form-control" placeholder="Ingrese nombre del canal"
                required/>
              <span class="msg-error" *ngIf="!caudal.valid && caudal.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!longitud.valid && longitud.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="longitud">Longitud</label>
              <input #longitud="ngModel" [(ngModel)]="canal.longitud" name="longitud" type="number" class="form-control" placeholder="Ingrese nombre del canal"
                required/>
              <span class="msg-error" *ngIf="!longitud.valid && longitud.touched">Campo incorrecto</span>
            </div>

          </div>

          <div class="col-xs-6">

            <div [ngClass]="(!tipica.valid && tipica.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="unidad">Seleccione la sección tipica</label>
              <select #tipica="ngModel" [(ngModel)]="canal.seccionTipica" name="tipica" class="form-control" id="unidad" required>
                <option value="">-- Seleccione --</option>
                <option value="RECTANGULAR">Rectangular</option>
                <option value="CIRCULAR">Circular</option>
                <option value="TRAPEZOIDAL">Trapezoidal</option>
              </select>
              <span class="msg-error" *ngIf="!tipica.valid && tipica.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!clase.valid && clase.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="unidad">Seleccione la clase</label>
              <select #clase="ngModel" [(ngModel)]="canal.clase" name="clase" class="form-control" id="unidad" required>
                <option value="">-- Seleccione --</option>
                <option value="RIEGO">Riego</option>
                <option value="DRENAJE">Drenaje</option>
                <option value="MIXTO">Mixto</option>
              </select>
              <span class="msg-error" *ngIf="!clase.valid && clase.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!tipo.valid && tipo.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="unidad">Seleccione el tipo</label>
              <select #tipo="ngModel" [(ngModel)]="canal.tipo" name="tipo" class="form-control" id="unidad" required>
                <option value="">-- Seleccione --</option>
                <option value="REVESTIDO">Revestido</option>
                <option value="TIERRA">Tierra</option>
                <option value="MIXTO">Mixto</option>
              </select>
              <span class="msg-error" *ngIf="!tipo.valid && tipo.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!estado.valid && estado.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="unidad">Seleccione el estado</label>
              <select #estado="ngModel" [(ngModel)]="canal.estado" name="estado" class="form-control" id="unidad" required>
                <option value="">-- Seleccione --</option>
                <option value="BUENO">Bueno</option>
                <option value="REGULAR">Regular</option>
                <option value="MALO">Malo</option>
              </select>
              <span class="msg-error" *ngIf="!estado.valid && estado.touched">Campo obligatorio</span>
            </div>

          </div>
        </div>
      </tab>

      <tab heading="Categoria" [disabled]="!estado.valid || !tipo.valid || !clase.valid || !tipica.valid || !longitud.valid || !caudal.valid || !nombre.valid || !codigo.valid">

        <br/>

        <div class="row">

          <div class="col-xs-6">

            <div [ngClass]="(!categoria.valid && categoria.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="categoria">Seleccione la unidad</label>
              <select #categoria="ngModel" [(ngModel)]="canal.categoria" name="categoria" class="form-control" id="categoria" required>
                <option value="">-- Seleccione --</option>
                <option value="CANAL_PRINCIPAL">Canal principal</option>
                <option value="CANAL_DISTRIBUCION">Canal de distribucion</option>
                <option value="CANAL_LATERAL">Canal lateral</option>
                <option value="CANAL_TERCIARIO">Canal terciario</option>
              </select>
              <span class="msg-error" *ngIf="!categoria.valid && categoria.touched">Campo obligatorio</span>
            </div>

          </div>

          <div class="col-xs-6" *ngIf="canal.categoria != '' && canal.categoria != 'CANAL_PRINCIPAL'">

            <div [ngClass]="(!unidadDos.valid && unidadDos.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="unidad2">Seleccione la unidad</label>
              <select #unidadDos="ngModel" [(ngModel)]="unidad2" (change)="unidadDosChange()" name="unidadDos" class="form-control" id="unidadDos"
                required>
                <option value="">-- Seleccione --</option>
                <option *ngFor="let u of lstUnidad" value="{{u.id}}">{{u.nombre}}</option>
                <option *ngIf="lstUnidad.length == 0" value="">No hay unidades</option>
              </select>
              <span class="msg-error" *ngIf="!unidadDos.valid && unidadDos.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!zonaDos.valid && zonaDos.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="zonaDos">Seleccione la zona</label>
              <select #zonaDos="ngModel" [(ngModel)]="zona2" (change)="zonaDosChange()" name="zonaDos" class="form-control" id="zonaDos"
                required>
                <option value="">-- Seleccione --</option>
                <option *ngFor="let z of lstZona2" value="{{z.id}}">{{z.nombre}}</option>
                <option *ngIf="lstZona2.length == 0" value="">No hay zonas</option>
              </select>
              <span class="msg-error" *ngIf="!zonaDos.valid && zonaDos.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!seccionDos.valid && seccionDos.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="seccionDos">Seleccione la sección</label>
              <select #seccionDos="ngModel" [(ngModel)]="seccion2" (change)="seccionDosChange()" name="seccionDos" class="form-control"
                id="seccionDos" required>
                <option value="">-- Seleccione --</option>
                <option *ngFor="let s of lstSeccion2" value="{{s.id}}">{{s.nombre}}</option>
                <option *ngIf="lstSeccion2.length == 0" value="">No hay secciones</option>
              </select>
              <span class="msg-error" *ngIf="!seccionDos.valid && seccionDos.touched">Campo obligatorio</span>
            </div>

            <div [ngClass]="(!canalDos.valid && canalDos.touched) ? 'form-group has-error' : 'form-group'">
              <label class="control-label" for="canalDos">Seleccione el canal</label>
              <select #canalDos="ngModel" [(ngModel)]="canal2" name="canalDos" class="form-control" id="canalDos" required>
                <option value="">-- Seleccione --</option>
                <option *ngFor="let c of lstCanal2" value="{{c.id}}">{{c.nombre}}</option>
                <option *ngIf="lstCanal2.length == 0" value="">No hay canales</option>
              </select>
              <span class="msg-error" *ngIf="!canalDos.valid && canalDos.touched">Campo obligatorio</span>
            </div>

          </div>
        </div>

      </tab>

      <tab heading="Obras" [disabled]="!form.form.valid">

        <br/>

        <div class="row">
          <div class="col-xs-6">

            <div class="form-row">
              <div class="form-group col-xs-9">
                <label for="obras">Obras</label>
                <input [(ngModel)]="obraNombre" #obras="ngModel" name="obras" type="text" class="form-control" placeholder="Ingrese nombre de la obra (Opcional)"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-xs-3">
                <br>
                <button class="btn btn-success" type="button" (click)="agregarObra()">Agregar</button>
              </div>
            </div>
          </div>

          <div class="col-xs-6">

            <ul class="list-group" *ngIf="lstObra.length != 0">
              <li *ngFor="let o of lstObra; let i = index" [attr.data-index]="i" class="list-group-item">
                {{o.nombre}}
                <span style="cursor: pointer" (click)="eliminarObra(i)" class="badge badge-default badge-pill">eliminar</span>
              </li>
            </ul>
          </div>
        </div>
        <button [disabled]="!form.form.valid || unidadId == -1 || zonaId == -1 " type="submit" class="btn btn-primary">Registrar</button>
      </tab>

    </tabset>


  </form>
</div>